<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Account</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    .container { max-width: 800px; margin: 0 auto; }
    .section { border: 1px solid #ccc; padding: 1em; margin-bottom: 1em; border-radius: 5px; }
    h2 { margin-top: 0; }
    input, button, select { padding: 0.5em; }
    button { cursor: pointer; }
    .modal { position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
    .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .modal-form-grid {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 0.8em;
      align-items: center;
    }
    #manage-models-modal .modal-form-grid {
      gap: 1.2em;
    }
    .modal-form-grid label {
      text-align: right;
      font-weight: bold;
    }
    .modal-form-grid input, .modal-form-grid textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 0.5em;
    }
    .modal-form-grid .full-width {
      grid-column: 1 / -1;
    }
    .modal-form-grid .full-width label {
      text-align: left;
      margin-bottom: 0.5em;
      display: block;
    }
    #edit-openai-fields .modal-form-grid label {
        text-align: right;
    }
    #edit-openai-fields .full-width label {
        text-align: left;
    }
    .modal-form-grid .full-width textarea {
      resize: vertical;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 1.5em;
      gap: 0.5em;
    }
    .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
    .close-button:hover, .close-button:focus { color: black; text-decoration: none; cursor: pointer; }
    #api-keys-list, #access-tokens-list { list-style-type: none; padding: 0; }
    #api-keys-list li, #access-tokens-list li { display: flex; justify-content: space-between; align-items: center; padding: 0.5em; border-bottom: 1px solid #eee; gap: 1em; }
    .key-info { flex-grow: 1; margin-right: 1em; word-break: break-all; }
    .key-actions { display: flex; gap: 0.5em; align-items: center; flex-shrink: 0; }
    .hidden { display: none; }
    #manage-models-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.2em 1em; /* row-gap column-gap */
      max-height: 250px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 0.8em;
      border-radius: 4px;
      list-style-type: none;
      margin: 0;
    }
    #manage-models-list li {
      display: flex;
      align-items: center;
      gap: 0.5em;
      padding: 0.2em 0;
      /* Let the label handle overflow */
    }
    #manage-models-list li input[type="checkbox"] {
      flex-shrink: 0;
      width: auto; /* Override the global width: 100% from .modal-form-grid input */
    }
    #manage-models-list li label {
      font-weight: normal;
      text-align: left;
      cursor: pointer;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0; /* Important for flexbox truncation */
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1em;
      margin-top: 1em;
    }
    .form-grid input, .form-grid select, .form-grid textarea, .form-grid button {
      width: 100%;
      box-sizing: border-box;
    }
    .form-grid .grid-col-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1em;
    }
    .nested-fields {
      border: 1px solid #eee;
      padding: 1em;
      border-radius: 5px;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>My Account</h1>

    <!-- Auth Section -->
    <div id="auth-section" class="section">
      <h2>Login or Register</h2>
      <div id="login-view">
        <p>Already have a token? Enter it here to manage your keys.</p>
        <input type="text" id="login-token-input" placeholder="Enter your API Token (sk-...)" autocomplete="off">
        <button id="login-button">Login</button>
        <p>Don't have a token? <a href="#" id="show-register-link">Register here</a>.</p>
      </div>
      <div id="registration-view" class="hidden">
        <p>Register to get a new API token.</p>
        <input type="text" id="register-name" placeholder="Your name (optional)">
        <button id="register-button">Register</button>
        <p>Already have a token? <a href="#" id="show-login-link">Login here</a>.</p>
      </div>
    </div>

    <!-- API Token Display Section -->
    <div id="token-section" class="section hidden">
      <h2>Your API Token</h2>
      <p>Store this token securely. It's used to authenticate your API requests.</p>
      <pre><code id="api-token-display"></code></pre>
      <button id="manage-keys-button">Manage My API Keys</button>
    </div>

    <!-- API Key Management Section -->
    <div id="api-key-management-section" class="section hidden">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>Manage API Keys</h2>
        <button id="logout-button">Logout</button>
      </div>

      <h3>Your Keys</h3>
      <ul id="api-keys-list"></ul>
      <p id="no-keys-message" class="hidden">You don't have any API keys yet.</p>

      <h3>Create New API Key</h3>
      <div class="form-grid">
        <div class="grid-col-2">
          <select id="provider-select"></select>
          <input type="text" id="key-notes-input" placeholder="Notes (e.g., 'My personal account')">
        </div>
        <input type="text" id="key-data-input" placeholder="Enter your key from the provider">
        <div id="openai-fields" class="hidden nested-fields">
          <input type="text" id="base-url-input" placeholder="Base URL (optional, defaults to OpenAI)">
          <textarea id="available-models-input" placeholder="Available Models (one per line, e.g., gpt-5)" rows="3" style="margin-top: 1em;"></textarea>
        </div>
        <button id="create-key-button">Create Key</button>
      </div>

      <hr style="margin: 2em 0;">

      <h3>Access Tokens (API-only Keys)</h3>
      <p>Create API-only tokens that can call the LLM API but cannot manage your account. These are safer to share or use in applications.</p>
      <ul id="access-tokens-list"></ul>
      <p id="no-access-tokens-message" class="hidden">You don't have any access tokens yet.</p>

      <h4>Create New Access Token</h4>
      <div class="form-grid">
        <div class="grid-col-2">
          <input type="text" id="access-token-name-input" placeholder="Token name (optional, e.g., 'My App Token')">
          <button id="create-access-token-button">Create Access Token</button>
        </div>
      </div>

      <hr style="margin: 2em 0;">

      <h3>Model Aliases</h3>
      <p>Create custom aliases for model names. This allows you to use simpler names in AI tools that don't support custom model names.</p>
      <ul id="model-aliases-list"></ul>
      <p id="no-aliases-message" class="hidden">You don't have any model aliases yet.</p>

      <h4>Create New Model Alias</h4>
      <div class="form-grid">
        <div class="grid-col-2">
          <input type="text" id="alias-name-input" placeholder="Alias name (e.g., 'my-model')">
          <input type="text" id="alias-models-input" placeholder="Target models (e.g., 'provider/model1,model2')">
        </div>
        <button id="create-alias-button">Create Alias</button>
      </div>
      <p style="font-size: 0.9em; color: #666; margin-top: 0.5em;">
        Note: The target models support the same format as API requests, including provider prefixes and comma-separated fallback models.
      </p>
    </div>
  </div>

  <!-- Edit Key Modal -->
  <div id="edit-key-modal" class="modal hidden">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2>Edit API Key</h2>
      <input type="hidden" id="edit-key-id">
      <div class="modal-form-grid">
        <label>Provider:</label>
        <b id="edit-key-provider"></b>

        <label for="edit-key-data-input">Key:</label>
        <input type="text" id="edit-key-data-input" placeholder="Enter your key from the provider">

        <label for="edit-key-notes-input">Notes:</label>
        <input type="text" id="edit-key-notes-input" placeholder="Notes (e.g., 'My personal account')">

        <label for="edit-base-url-input" id="edit-base-url-label" class="hidden">Base URL:</label>
        <input type="text" id="edit-base-url-input" placeholder="Base URL (optional)" class="hidden">

        <!-- This is now handled by the Manage Models modal -->
        <div id="edit-available-models-container" class="hidden full-width"></div>
      </div>
      <div class="modal-buttons">
        <button id="save-key-button">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Manage Models Modal -->
  <div id="manage-models-modal" class="modal hidden">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2>Manage Available Models</h2>
      <input type="hidden" id="manage-models-key-id">
      <div class="modal-form-grid">
        <div class="full-width">
          <label>Provider Models:</label>
          <p style="font-size: 0.9em; color: #666; margin-top: 0; margin-bottom: 0.5em;">Uncheck to exclude a model from this key.</p>
          <ul id="manage-models-list"></ul>
        </div>
        <div class="full-width">
          <label for="manage-models-custom-input">Custom Models (one per line):</label>
          <textarea id="manage-models-custom-input" rows="4" placeholder="my-custom-model-1&#x000A;my-custom-model-2"></textarea>
        </div>
      </div>
      <div class="modal-buttons">
        <button id="save-models-button">Save Changes</button>
      </div>
    </div>
  </div>

  <script src="user.js"></script>
</body>
</html>
